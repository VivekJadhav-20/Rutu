<!DOCTYPE html>
<html>
<head>
    <title>My Friend Flappy Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #70c5ce; 
            overflow: hidden;
            touch-action: none;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
            margin: 0 auto;
            background: #70c5ce;
        }
        #score {
            position: absolute;
            top: 10%;
            width: 100%;
            text-align: center;
            font-size: 50px;
            color: white;
            font-weight: bold;
            pointer-events: none;
            text-shadow: 2px 2px 4px #000;
        }
        #startMsg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px #000;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="score">0</div>
<div id="startMsg">Tap or Press Space to Start!</div>
<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // --- CONFIGURATION ---
    const birdImageSrc = 'face.png'; 
    const jumpSoundSrc = 'jump.mp3';
    // ---------------------

    // Resize canvas
    canvas.width = window.innerWidth > 480 ? 480 : window.innerWidth;
    canvas.height = window.innerHeight;

    // Load Assets
    const birdImg = new Image();
    birdImg.src = birdImageSrc;
    
    const jumpAudio = new Audio();
    jumpAudio.src = jumpSoundSrc;

    // Game Variables
    let frames = 0;
    let score = 0;
    let gameState = "START"; 
    const gravity = 0.25;
    const speed = 3; 

    // --- FUNNY VOICE FUNCTION ---
    function speakMist() {
        if ('speechSynthesis' in window) {
            // Create the speech object
            const msg = new SpeechSynthesisUtterance("Mist!");
            
            // MAKE IT FUNNY:
            msg.pitch = 2.0; // High pitch (Chipmunk style)
            msg.rate = 1.2;  // Slightly faster
            msg.volume = 1;

            // Speak it
            window.speechSynthesis.speak(msg);
        }
    }

    // Helper to trigger Game Over logic safely
    function triggerGameOver() {
        if (gameState !== "GAMEOVER") {
            gameState = "GAMEOVER";
            speakMist(); // <--- Plays the voice here!
        }
    }

    const bird = {
        x: 50,
        y: 150,
        w: 50, 
        h: 50, 
        radius: 20,
        velocity: 0,
        jump: 4.6,
        
        draw: function() {
            if (birdImg.complete && birdImg.naturalHeight !== 0) {
                 ctx.drawImage(birdImg, this.x, this.y, this.w, this.h);
            } else {
                ctx.fillStyle = "red";
                ctx.fillRect(this.x, this.y, this.w, this.h);
            }
        },
        
        flap: function() {
            this.velocity = -this.jump;
            if (jumpAudio.readyState >= 2) {
                jumpAudio.currentTime = 0;
                jumpAudio.play().catch(e => console.log("Audio play failed"));
            }
        },
        
        update: function() {
            this.velocity += gravity;
            this.y += this.velocity;
            
            // Floor collision
            if (this.y + this.h >= canvas.height - 10) { 
                this.y = canvas.height - 10 - this.h;
                triggerGameOver(); // Calls the voice
            }
        }
    };

    const pipes = {
        position: [],
        w: 50,
        gap: 150,
        dx: 3,
        
        draw: function() {
            for(let i = 0; i < this.position.length; i++){
                let p = this.position[i];
                let topY = p.y;
                let bottomY = p.y + this.gap;
                
                ctx.fillStyle = "#2e8b57"; 
                ctx.fillRect(p.x, 0, this.w, topY); 
                ctx.fillRect(p.x, bottomY, this.w, canvas.height - bottomY); 
                
                ctx.strokeStyle = "black";
                ctx.lineWidth = 2;
                ctx.strokeRect(p.x, 0, this.w, topY);
                ctx.strokeRect(p.x, bottomY, this.w, canvas.height - bottomY);
            }
        },
        
        update: function() {
            if (frames % 120 === 0) {
                this.position.push({
                    x: canvas.width,
                    y: Math.random() * (canvas.height - 300) + 50
                });
            }
            
            for(let i = 0; i < this.position.length; i++){
                let p = this.position[i];
                p.x -= this.dx;

                // Collision Detection
                if (bird.x + bird.w > p.x && bird.x < p.x + this.w) {
                    if (bird.y < p.y || bird.y + bird.h > p.y + this.gap) {
                        triggerGameOver(); // Calls the voice
                    }
                }

                if(p.x + this.w <= 0){
                    this.position.shift();
                    score++; 
                    document.getElementById("score").innerText = score;
                }
            }
        },
        
        reset: function() {
            this.position = [];
        }
    };

    function loop(){
        ctx.fillStyle = "#70c5ce";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (gameState === "PLAYING") {
            bird.update();
            pipes.update();
            frames++;
        }

        pipes.draw();
        bird.draw();
        
        ctx.fillStyle = "#ded895";
        ctx.fillRect(0, canvas.height - 10, canvas.width, 10);

        if (gameState === "GAMEOVER") {
            ctx.fillStyle = "rgba(0,0,0,0.5)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = "white";
            ctx.font = "40px Arial";
            ctx.textAlign = "center";
            ctx.fillText("Game Over", canvas.width/2, canvas.height/2);
            ctx.font = "20px Arial";
            ctx.fillText("Tap to Restart", canvas.width/2, canvas.height/2 + 40);
        }

        requestAnimationFrame(loop);
    }

    loop();

    function action() {
        if (gameState === "START") {
            gameState = "PLAYING";
            document.getElementById("startMsg").style.display = "none";
            bird.flap();
        } else if (gameState === "PLAYING") {
            bird.flap();
        } else if (gameState === "GAMEOVER") {
            // Reset Game
            bird.y = 150;
            bird.velocity = 0;
            pipes.reset();
            score = 0;
            document.getElementById("score").innerText = score;
            gameState = "START";
            document.getElementById("startMsg").style.display = "block";
        }
    }

    window.addEventListener("keydown", function(e){
        if(e.code === "Space") action();
    });
    window.addEventListener("touchstart", function(e){
        e.preventDefault(); 
        action();
    }, {passive: false});
    window.addEventListener("mousedown", action);

</script>
</body>
</html>